<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Avaliação de Desempenho</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <style>
    :root {
      --primary: #1a73e8;
      --primary-light: #4285f4;
      --primary-dark: #0d47a1;
      --secondary: #f8f9fa;
      --text: #202124;
      --text-light: #5f6368;
      --border: #dadce0;
    }
    
    body {
      font-family: 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background-color: #f8fafc;
      color: var(--text);
      line-height: 1.6;
    }
    
    .container {
      max-width: 1200px;
      margin: 30px auto;
      padding: 25px;
      background-color: white;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
    }
    
    .header {
      display: flex;
      align-items: center;
      gap: 20px;
      padding-bottom: 15px;
      margin-bottom: 25px;
      border-bottom: 1px solid var(--border);
    }
    
    .header img {
      height: 80px;
      filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
    }
    
    .header h1 {
      font-size: 1.8rem;
      font-weight: 600;
      color: var(--primary-dark);
      margin: 0;
    }
    
    .section-title {
      margin: 35px 0 20px 0;
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
      color: white;
      padding: 12px 20px;
      font-weight: 600;
      font-size: 1.1rem;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }
    
    .form-group {
      margin-bottom: 1.2rem;
    }
    
    label {
      font-weight: 500;
      color: var(--text);
      margin-bottom: 0.4rem;
      display: block;
    }
    
    .form-control {
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 0.5rem 0.75rem;
      transition: all 0.2s;
    }
    
    .form-control:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 0.2rem rgba(26, 115, 232, 0.25);
    }
    
    input[type="number"] {
      width: 70px;
      text-align: center;
    }
    
    .avaliacao-table {
      width: 100%;
      margin-bottom: 1.5rem;
      border-collapse: separate;
      border-spacing: 0;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }
    
    .avaliacao-table th {
      background-color: var(--primary);
      color: white;
      font-weight: 500;
      padding: 12px;
      text-align: center;
    }
    
    .avaliacao-table td {
      padding: 10px;
      text-align: center;
      vertical-align: middle;
      background-color: white;
      border: 1px solid var(--border);
    }
    
    .avaliacao-table input[type="number"] {
      width: 60px;
      margin: 0 auto;
    }
    
    .factor-item {
      margin-bottom: 1.2rem;
      padding: 15px;
      background-color: white;
      border-radius: 8px;
      border: 1px solid var(--border);
      transition: all 0.2s;
    }
    
    .factor-item:hover {
      border-color: var(--primary);
      box-shadow: 0 2px 8px rgba(26, 115, 232, 0.1);
    }
    
    .factor-item label {
      font-weight: 600;
      color: var(--primary-dark);
    }
    
    .factor-desc {
      font-size: 0.85rem;
      color: var(--text-light);
      margin-bottom: 0.8rem;
    }
    
    .media-container {
      display: flex;
      gap: 30px;
      margin: 25px 0;
      padding: 15px;
      background-color: var(--secondary);
      border-radius: 8px;
    }
    
    .media-item {
      flex: 1;
    }
    
    .media-value {
      font-size: 1.4rem;
      font-weight: 600;
      color: var(--primary);
    }
    
    textarea {
      min-height: 100px;
      resize: vertical;
    }
    
    .btn-container {
      display: flex;
      gap: 12px;
      margin-top: 30px;
      flex-wrap: wrap;
    }
    
    .btn {
      padding: 0.6rem 1.2rem;
      border-radius: 6px;
      font-weight: 500;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    
    .btn-primary {
      background-color: var(--primary);
      border-color: var(--primary);
    }
    
    .btn-primary:hover {
      background-color: var(--primary-dark);
      border-color: var(--primary-dark);
    }
    
    .btn-success {
      background-color: #34a853;
      border-color: #34a853;
    }
    
    .btn-success:hover {
      background-color: #2d8e47;
      border-color: #2d8e47;
    }
    
    .btn-secondary {
      background-color: #5f6368;
      border-color: #5f6368;
    }
    
    .btn-secondary:hover {
      background-color: #4d5156;
      border-color: #4d5156;
    }
    
    .date-info {
      font-size: 0.9rem;
      color: var(--text-light);
      margin-top: 20px;
    }
    
    @media (max-width: 768px) {
      .header {
        flex-direction: column;
        text-align: center;
      }
      
      .media-container {
        flex-direction: column;
        gap: 15px;
      }
      
      .btn-container {
        flex-direction: column;
      }
      
      .btn {
        width: 100%;
        justify-content: center;
      }
    }
  </style>
</head>
<body>
  <div class="container" id="formulario">
    <div class="header">
      <img src="guarda.jpg" alt="Logo da organização" class="img-fluid">
      <h1>Avaliação de Desempenho - Educadores Sociais</h1>
    </div>

    <div class="row">
      <div class="col-md-6">
        <div class="form-group">
          <label>Nome do Colaborador:</label>
          <input type="text" class="form-control" name="nome">
        </div>
      </div>
      <div class="col-md-6">
        <div class="form-group">
          <label>Cargo:</label>
          <input type="text" class="form-control" name="cargo">
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-md-6">
        <div class="form-group">
          <label>Data de Admissão:</label>
          <input type="date" class="form-control" name="admissao">
        </div>
      </div>
      <div class="col-md-6">
        <div class="form-group">
          <label>Período Avaliado:</label>
          <input type="text" class="form-control" name="periodo">
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-md-6">
        <div class="form-group">
          <label>Supervisão:</label>
          <input type="text" class="form-control" name="supervisao">
        </div>
      </div>
      <div class="col-md-6">
        <div class="form-group">
          <label>Coordenação:</label>
          <input type="text" class="form-control" name="coordenacao">
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-md-6">
        <div class="form-group">
          <label>Gerência Geral:</label>
          <input type="text" class="form-control" value="CLÁUDIO MELO" disabled>
        </div>
      </div>
      <div class="col-md-6">
        <div class="form-group">
          <label>Gestão de Pessoas/DPTO Pessoal:</label>
          <input type="text" class="form-control" value="JULIANA DE MEIRA" disabled>
        </div>
      </div>
    </div>

    <div class="section-title">Fatores Gerais (1 a 12)</div>
    <div id="fatores-gerais"></div>

    <div class="section-title">Fatores Específicos (13 a 20)</div>
    <div id="fatores-especificos"></div>

    <div class="form-group">
      <label>Comentários:</label>
      <textarea class="form-control" name="comentarios" rows="3"></textarea>
    </div>

    <div class="media-container">
      <div class="media-item">
        <label>Média Fatores Gerais:</label>
        <div class="media-value" id="mediaGerais">0.0</div>
      </div>
      <div class="media-item">
        <label>Média Fatores Específicos:</label>
        <div class="media-value" id="mediaEspecificos">0.0</div>
      </div>
      <div class="media-item">
        <label>Média Total:</label>
        <div class="media-value" id="mediaTotal">0.0</div>
      </div>
    </div>

    <div class="btn-container">
      <button class="btn btn-primary" onclick="gerarPDF()">
        <i class="fas fa-file-pdf"></i> Gerar PDF
      </button>
      <button class="btn btn-success" onclick="exportarXLS()">
        <i class="fas fa-file-excel"></i> Exportar XLS
      </button>
      <button class="btn btn-secondary" onclick="window.open('https://forms.gle/eA32geGeuyEw4s6a7', '_blank')">
        <i class="fas fa-archive"></i> Arquivar
      </button>
    </div>

    <div class="date-info">
      <strong>Data:</strong> <span id="dataAtual"></span>
    </div>
  </div>

  <!-- Todos os scripts JavaScript originais são mantidos exatamente como estão -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  
  <script>
    // Todos os scripts originais são mantidos intactos abaixo
    document.getElementById('dataAtual').textContent = new Date().toLocaleDateString('pt-BR');

    const fatoresGerais = [
      "Relacionamento Interpessoal", "Disciplina", "Assiduidade", "Pontualidade",
      "Responsabilidade", "Organização", "Comprometimento", "Produtividade",
      "Proatividade", "Ética Profissional", "Iniciativa", "Trabalho em Equipe"
    ];

    const fatoresEspecificos = [
      { nome: "Rotina de sala de atividade", subitens: ["Autogestão", "Acolhida", "Desenv. Ativ.", "Finaliz. Ativ.", "Avaliação", "Intervalo/Almoço", "Trânsito pela Entidade"] },
      { nome: "Escalas de acompanhamento aos educandos", subitens: ["Pontualidade", "Atenção", "Orientação", "Comunicação"] },
      { nome: "Planejamento", subitens: ["Pontualidade", "Preenchimento Adequado", "Solicit. Materiais", "Execução"] },
      { nome: "Percurso", subitens: ["Adequação", "Aplicabilidade", "Cronologia", "Efetividade"] },
      { nome: "Pacto de Convivência e Orientações Comportamentais", subitens: ["Apropriação", "Respeito", "Orientação", "Preenchimento Adequado", "Encaminhamento"] },
      { nome: "Atendimento com educando e família", subitens: ["Postura", "Posição", "Ética", "Integração"] },
      { nome: "Informação e pertencimento SCFV/GML", subitens: ["Alinhamento Valores", "Alinhamento Missão", "Noções Direitos Humanos", "SUAS", "ECA", "Desenv. Pertencimento"] },
      { nome: "Mediação de Conflitos", subitens: ["Prevenção", "Mediação", "Resolução"] }
    ];

    function criarTabelaFatoresGerais() {
      const container = document.getElementById('fatores-gerais');

      const nomes = [
        "Pontualidade",
        "Assiduidade",
        "Disciplina e Organização",
        "Adaptação",
        "Relacionamento interpessoal",
        "Iniciativa",
        "Interesse",
        "Conhecimento",
        "Qualidade técnica",
        "Postura ética",
        "Saúde e segurança",
        "Consumo consciente"
      ];

      const descricoes = [
        "o colaborador cumpre o horário de entrada e saída da entidade",
        "o colaborador cumpre a carga horária definida justificando, quando necessária, a ausência/falta",
        "o colaborador cumpre o regimento interno, pacto de convivência e orientações voltadas para a efetividade do trabalho",
        "o colaborador identifica-se com as atividades de seu cargo e com as características da entidade, reagindo positivamente às mudanças necessárias",
        "o colaborador comunica-se de forma positiva e tem bom relacionamento/fácil convivência com superiores, colegas, educandos e seus familiares.",
        "o colaborador demonstra atitude proativa e apresenta alternativas e sugestões para providências voltadas para a resolução de questões cotidianas e melhorias das atividades que desenvolve.",
        "o colaborador demonstra dedicação e esforço pessoal em aperfeiçoar-se cada vez mais para assumir novas responsabilidades.",
        "o colaborador tem conhecimento teórico e prático para a execução das atividades.",
        "o colaborador tem domínio dos processos, ferramentas e habilidades necessárias ao desempenho das atividades.",
        "o colaborador tem atitudes de idoneidade, cidadania e integridade com relação à entidade, colegas e educandos, respeitando o sigilo.",
        "tem conhecimento sobre as orientações acerca da segurança no trabalho e age de maneira preventiva a evitar danos à saúde, fazendo uso adequado de equipamentos de proteção, quando necessário.",
        "compreende sobre a relevância de projetos de desenvolvimento sustentável e de consumo consciente, evitando consumo excessivo de recursos materiais e alimentícios."
      ];

      nomes.forEach((nome, i) => {
        const div = document.createElement('div');
        div.className = 'factor-item';
        div.innerHTML = `
          <label>${i + 1}. ${nome}</label>
          <div class="factor-desc">${descricoes[i]}</div>
          <input type="number" class="form-control" name="fator${i + 1}" min="0" max="10" onchange="calcularMedias()">
        `;
        container.appendChild(div);
      });
    }

    function criarTabelaFatoresEspecificos() {
      const container = document.getElementById('fatores-especificos');
      fatoresEspecificos.forEach((item, idx) => {
        const table = document.createElement('table');
        table.className = 'table table-bordered avaliacao-table';
        let html = `<thead><tr><th colspan="${item.subitens.length + 2}">${idx + 13}. ${item.nome}</th></tr>`;
        html += `<tr><th>Item</th>`;
        item.subitens.forEach(sub => {
          html += `<th>${sub}</th>`;
        });
        html += `<th>Média</th></tr></thead><tbody><tr><td></td>`;
        item.subitens.forEach((_, i) => {
          html += `<td><input type="number" name="esp${idx}_${i}" min="0" max="10" onchange="calcularMedias()"></td>`;
        });
        html += `<td><span id="mediaEsp${idx}">0.0</span></td>`;
        html += `</tr></tbody>`;
        table.innerHTML = html;
        container.appendChild(table);
      });
    }

    function calcularMedias() {
      let somaGerais = 0, somaEspecificos = 0;
      fatoresGerais.forEach((_, i) => {
        const val = parseFloat(document.querySelector(`[name='fator${i + 1}']`).value) || 0;
        somaGerais += val;
      });
      const mediaGerais = (somaGerais / fatoresGerais.length).toFixed(1);
      document.getElementById('mediaGerais').textContent = mediaGerais;

      fatoresEspecificos.forEach((item, idx) => {
        let soma = 0;
        item.subitens.forEach((_, i) => {
          soma += parseFloat(document.querySelector(`[name='esp${idx}_${i}']`).value) || 0;
        });
        const media = (soma / item.subitens.length).toFixed(1);
        document.getElementById(`mediaEsp${idx}`).textContent = media;
        somaEspecificos += parseFloat(media);
      });
      const mediaEspecificos = (somaEspecificos / fatoresEspecificos.length).toFixed(1);
      document.getElementById('mediaEspecificos').textContent = mediaEspecificos;

      const mediaTotal = ((parseFloat(mediaGerais) + parseFloat(mediaEspecificos)) / 2).toFixed(1);
      document.getElementById('mediaTotal').textContent = mediaTotal;
    }

    criarTabelaFatoresGerais();
    criarTabelaFatoresEspecificos();

    // Funções originais para gerar PDF e XLS são mantidas exatamente como estão
    async function gerarPDF() {
      const { jsPDF } = window.jspdf;

      // Carrega fundo e logo
      const fundoImg = new Image();
      fundoImg.src = 'fundo.jpg';
      await new Promise(resolve => fundoImg.onload = resolve);

      // Função para aplicar fundo em cada página
      function aplicarFundo(doc) {
        doc.addImage(fundoImg, 'JPEG', 0, 0, 210, 297);
      }

      const doc = new jsPDF('p', 'mm', 'a4');
      aplicarFundo(doc); // fundo na primeira página

      let y = 20;

      const nome = document.querySelector("[name='nome']").value || '';
      const cargo = document.querySelector("[name='cargo']").value || '';
      const admissao = document.querySelector("[name='admissao']").value || '';
      const periodo = document.querySelector("[name='periodo']").value || '';
      const supervisao = document.querySelector("[name='supervisao']").value || '';
      const coordenacao = document.querySelector("[name='coordenacao']").value || '';
      const mediaGerais = document.getElementById("mediaGerais").textContent;
      const mediaEspecificos = document.getElementById("mediaEspecificos").textContent;
      const mediaTotal = document.getElementById("mediaTotal").textContent;
      const comentarios = document.querySelector("[name='comentarios']").value || '';
      const dataAtual = document.getElementById("dataAtual").textContent;
      doc.setFontSize(16);
      doc.text("Questionário de Avaliação de Desempenho", 45, y + 10);
      y += 25;

      // Cabeçalho tabular
      doc.setFontSize(11);
      doc.setFont(undefined, 'bold');
      doc.text('COLABORADOR:', 10, y);
      doc.text('GESTORES:', 110, y);
      y += 6;
      doc.setFont(undefined, 'normal');

      const linhaEsq = [
        `Nome: ${nome}`, `Cargo: ${cargo}`,
        `Data Admissão: ${admissao}`, `Período Avaliado: ${periodo}`
      ];
      const linhaDir = [
        `Supervisão: ${supervisao}`, `Coordenação: ${coordenacao}`,
        `Gerência Geral: CLÁUDIO MELO`, `Gestão de Pessoas: JULIANA DE MEIRA`
      ];

      for (let i = 0; i < linhaEsq.length; i++) {
        doc.text(linhaEsq[i], 10, y);
        doc.text(linhaDir[i], 110, y);
        y += 6;
      }

      y += 4;
      doc.setFont(undefined, 'bold');
      doc.setFontSize(12);
      doc.text('Fatores Gerais (1 a 12)', 10, y);
      y += 6;

      // Fatores Gerais em 2 colunas
      doc.setFont(undefined, 'normal');
      let colY1 = y;
      let colY2 = y;
      for (let i = 0; i < fatoresGerais.length; i++) {
        const nomeFator = `${i + 1}. ${fatoresGerais[i]}`;
        const val = document.querySelector(`[name='fator${i + 1}']`).value || '0';
        const texto = `${nomeFator}: ${val}`;
        const x = i < 6 ? 10 : 110;
        const yPos = i < 6 ? colY1 : colY2;
        doc.text(texto, x, yPos);
        if (i < 6) colY1 += 6;
        else colY2 += 6;
      }

      y = Math.max(colY1, colY2) + 10;

      // Fatores Específicos em 2 colunas
      doc.setFont(undefined, 'bold');
      doc.setFontSize(12);
      doc.text('Fatores Específicos (13 a 20)', 10, y);
      y += 6;
      doc.setFont(undefined, 'normal');

      let colYEsq = y;
      let colYDir = y;
      for (let idx = 0; idx < fatoresEspecificos.length; idx++) {
        const fator = fatoresEspecificos[idx];
        const x = idx < 4 ? 10 : 110;
        let yAtual = idx < 4 ? colYEsq : colYDir;

        doc.setFont(undefined, 'bold');
        const titulo = doc.splitTextToSize(`${idx + 13}. ${fator.nome}`, 80);
        doc.text(titulo, x, yAtual);
        yAtual += titulo.length * 5;

        doc.setFont(undefined, 'normal');
        fator.subitens.forEach((sub, i) => {
          const val = document.querySelector(`[name='esp${idx}_${i}']`).value || '0';
          const linha = `${sub}: ${val}`;
          const linhas = doc.splitTextToSize(linha, 80);
          doc.text(linhas, x + 4, yAtual);
          yAtual += linhas.length * 5;
        });

        const media = document.getElementById(`mediaEsp${idx}`).textContent;
        doc.setFont(undefined, 'italic');
        doc.text(`Média: ${media}`, x + 4, yAtual);
        yAtual += 10;

        if (idx < 4) colYEsq = yAtual;
        else colYDir = yAtual;
      }

      y = Math.max(colYEsq, colYDir) + 10;

      // Quebra forçada se necessário
      if (y + 40 > 270) {
        doc.addPage();
        aplicarFundo(doc);
        y = 20;
        y += 18; // 3 linhas em branco (3 x 6)
      }

      doc.setFont(undefined, 'bold');
      doc.text(`Média Fatores Gerais: ${mediaGerais}`, 10, y);
      y += 6;
      doc.text(`Média Fatores Específicos: ${mediaEspecificos}`, 10, y);
      y += 6;
      doc.text(`Média Total: ${mediaTotal}`, 10, y);
      y += 10;

      // Comentários
      if (comentarios.trim()) {
        doc.setFont(undefined, 'bold');
        doc.text('Comentários:', 10, y);
        y += 6;
        doc.setFont(undefined, 'normal');
        const comentarioLinhas = doc.splitTextToSize(comentarios, 180);
        doc.text(comentarioLinhas, 10, y);
        y += comentarioLinhas.length * 5;
      }

      // Assinaturas
      if (y + 50 > 280) {
        doc.addPage();
        aplicarFundo(doc);
        y = 20;
      }

      y += 10;
      const col1 = 10;
      const col2 = 110;

      doc.line(col1, y, col1 + 80, y);
      doc.line(col2, y, col2 + 80, y);
      doc.text('ASSINATURA SUPERVISÃO:', col1, y + 5);
      doc.text('ASSINATURA COLABORADOR:', col2, y + 5);
      y += 20;

      doc.line(col1, y, col1 + 80, y);
      doc.text('ASSINATURA COORDENAÇÃO:', col1, y + 5);
      y += 20;

      doc.line(col1, y, col1 + 80, y);
      doc.text('ASSINATURA GERÊNCIA GERAL:', col1, y + 5);
      y += 20;

      doc.line(col1, y, col1 + 80, y);
      doc.text('ASSINATURA RH/DP:', col1, y + 5);
      y += 14;

      doc.text(`Data: ${dataAtual}`, col1, y + 4);

      doc.save(`avaliacao_${nome.replace(/\s/g, '_')}.pdf`);
    }

    function exportarXLS() {
      const nome = document.querySelector("[name='nome']").value || '';
      const cargo = document.querySelector("[name='cargo']").value || '';
      const admissao = document.querySelector("[name='admissao']").value || '';
      const periodo = document.querySelector("[name='periodo']").value || '';

      const linha = [nome, cargo, admissao, periodo];

      // Fatores Gerais (1 a 12)
      fatoresGerais.forEach((_, i) => {
        const val = document.querySelector(`[name='fator${i + 1}']`).value || '0';
        linha.push(val);
      });

      // Fatores Específicos (13 a 20): subitens + média
      fatoresEspecificos.forEach((item, idx) => {
        item.subitens.forEach((_, i) => {
          const val = document.querySelector(`[name='esp${idx}_${i}']`).value || '0';
          linha.push(val);
        });
        const media = document.getElementById(`mediaEsp${idx}`).textContent;
        linha.push(media);
      });

      // Médias finais
      linha.push(document.getElementById('mediaGerais').textContent);
      linha.push(document.getElementById('mediaEspecificos').textContent);
      linha.push(document.getElementById('mediaTotal').textContent);

      const wb = XLSX.utils.book_new();
      const ws = XLSX.utils.aoa_to_sheet([linha]);
      XLSX.utils.book_append_sheet(wb, ws, "Avaliacao");
      XLSX.writeFile(wb, `avaliacao_${nome.replace(/\s/g, '_')}.xlsx`);
    }
  </script>
</body>
</html>