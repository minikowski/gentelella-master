<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Avaliação de Desempenho</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; }
    .container { max-width: 1200px; margin: auto; padding: 20px; }
    .header { display: flex; align-items: center; gap: 20px; border-bottom: 2px solid #000; padding-bottom: 10px; margin-bottom: 20px; }
    .header img { height: 80px; }
    .section-title { margin-top: 40px; background: #004080; color: #fff; padding: 10px; }
    .table input[type=number] { width: 70px; }
    .total-cell { background: #f0f0f0; font-weight: bold; }
    .info-table th { background-color: #28a745; color: #fff; text-align: center; }
    .avaliacao-table th, .avaliacao-table td { text-align: center; vertical-align: middle; }
    .assinaturas { margin-top: 60px; }
    .assinatura { display: inline-block; width: 30%; text-align: center; margin-right: 3%; }
    .assinatura hr { margin-top: 40px; margin-bottom: 5px; border: none; border-top: 1px solid #000; }
    .btns { margin-top: 30px; display: flex; gap: 15px; }
    .no-print { display: flex; gap: 15px; }
    textarea { resize: none; }
    @media print {
      .no-print { display: none !important; }
    }
  </style>
</head>
<body>
  <div class="container" id="formulario">
    <div class="header">
      <img src="guarda.jpg" alt="Logo Guarda Mirim" />
      <h1>Questionário de Avaliação de Desempenho</h1>
    </div>

    <!-- Cabeçalho com dados do colaborador e gestores -->
    <div class="row mb-3">
      <div class="col-md-6">
        <label>Nome do Colaborador:</label>
        <input type="text" class="form-control" name="nome" />
      </div>
      <div class="col-md-6">
        <label>Cargo:</label>
        <input type="text" class="form-control" name="cargo" />
      </div>
    </div>

    <div class="row mb-3">
      <div class="col-md-6">
        <label>Data de Admissão:</label>
        <input type="date" class="form-control" name="admissao" />
      </div>
      <div class="col-md-6">
        <label>Período Avaliado:</label>
        <input type="text" class="form-control" name="periodo" />
      </div>
    </div>

    <div class="row mb-3">
      <div class="col-md-6">
        <label>Supervisão:</label>
        <input type="text" class="form-control" name="supervisao" />
      </div>
      <div class="col-md-6">
        <label>Coordenação:</label>
        <input type="text" class="form-control" name="coordenacao" />
      </div>
    </div>

    <div class="row mb-3">
      <div class="col-md-6">
        <label>Gerência Geral:</label>
        <input type="text" class="form-control" value="CLÁUDIO MELO" disabled />
      </div>
      <div class="col-md-6">
        <label>Gestão de Pessoas/DPTO Pessoal:</label>
        <input type="text" class="form-control" value="JULIANA" disabled />
      </div>
    </div>

    <!-- Seções de Fatores Gerais e Específicos (conteúdo inserido via JS) -->
    <div class="section-title">Fatores Gerais (1 a 12)</div>
    <div id="fatores-gerais"></div>

    <div class="section-title" style="page-break-before: always;">Fatores Específicos (13 a 20)</div>
    <div id="fatores-especificos"></div>

    <div class="mb-3">
      <label>Comentários:</label>
      <textarea class="form-control" name="comentarios" rows="3"></textarea>
    </div>

    <p><strong>Média Fatores Gerais:</strong> <span id="mediaGerais">0.0</span></p>
    <p><strong>Média Fatores Específicos:</strong> <span id="mediaEspecificos">0.0</span></p>
    <p><strong>Média Total:</strong> <span id="mediaTotal">0.0</span></p>

    <div class="btns no-print">
      <button class="btn btn-primary" onclick="gerarPDF()">Gerar PDF</button>
      <button class="btn btn-success" onclick="exportarXLS()">Exportar XLS</button>
    </div>

    <div class="assinaturas">
      <div class="assinatura">
        <hr />
        <strong>Gestor Responsável</strong>
      </div>
      <div class="assinatura">
        <hr />
        <strong>Coordenação Pedagógica</strong>
      </div>
      <div class="assinatura">
        <hr />
        <strong>Gerência Geral</strong>
      </div>
      <div class="assinatura">
        <hr />
        <strong>Departamento Pessoal</strong>
      </div>
    </div>

    <p class="mt-4"><strong>Data:</strong> <span id="dataAtual"></span></p>
  </div>

  <!-- Script COMPLETO embutido vem em seguida -->
  <script>
    // JavaScript completo abaixo

// Subitens dos fatores gerais e específicos
const fatoresGerais = [
  { titulo: "1. Assiduidade", subitens: ["Frequência", "Pontualidade"] },
  { titulo: "2. Disciplina", subitens: ["Cumprimento das normas", "Comportamento ético"] },
  { titulo: "3. Responsabilidade", subitens: ["Cumprimento de tarefas", "Pontualidade nas entregas"] },
  { titulo: "4. Relacionamento interpessoal", subitens: ["Com colegas", "Com superiores"] },
  { titulo: "5. Interesse e iniciativa", subitens: ["Busca por soluções", "Proatividade"] },
  { titulo: "6. Organização", subitens: ["Ambiente de trabalho", "Gestão de tempo"] },
  { titulo: "7. Comprometimento", subitens: ["Envolvimento com o trabalho", "Empenho"] },
  { titulo: "8. Comunicação", subitens: ["Clareza na comunicação", "Escuta ativa"] },
  { titulo: "9. Qualidade do trabalho", subitens: ["Precisão", "Apresentação"] },
  { titulo: "10. Cumprimento de prazos", subitens: ["Entrega no prazo", "Agilidade"] },
  { titulo: "11. Conhecimento técnico", subitens: ["Habilidades técnicas", "Atualização"] },
  { titulo: "12. Trabalho em equipe", subitens: ["Colaboração", "Flexibilidade"] }
];

const fatoresEspecificos = [
  { titulo: "13. Atendimento ao público", subitens: ["Cortesia", "Agilidade"] },
  { titulo: "14. Operação de sistemas", subitens: ["Uso de software", "Eficiência"] },
  { titulo: "15. Segurança do trabalho", subitens: ["EPI", "Prevenção"] },
  { titulo: "16. Controle de documentos", subitens: ["Organização", "Acesso"] },
  { titulo: "17. Atividades pedagógicas", subitens: ["Planejamento", "Execução"] },
  { titulo: "18. Atividades operacionais", subitens: ["Tarefas diárias", "Cumprimento de metas"] },
  { titulo: "19. Relatórios e registros", subitens: ["Preenchimento", "Entrega"] },
  { titulo: "20. Apoio à gestão", subitens: ["Auxílio", "Pontualidade"] }
];

function criarTabelaFatores(fatores, containerId) {
  const container = document.getElementById(containerId);
  fatores.forEach((fator, i) => {
    const table = document.createElement("table");
    table.className = "table table-bordered avaliacao-table mt-3";

    const thead = table.createTHead();
    const row = thead.insertRow();
    row.insertCell().outerHTML = `<th colspan="${fator.subitens.length + 1}">${fator.titulo}</th>`;

    const subRow = table.insertRow();
    subRow.insertCell().outerHTML = `<th>Subitem</th>`;
    fator.subitens.forEach(s => subRow.insertCell().outerHTML = `<th>${s}</th>`);

    const inputRow = table.insertRow();
    inputRow.insertCell().outerHTML = `<td>Nota</td>`;
    fator.subitens.forEach((_, j) => {
      const input = document.createElement("input");
      input.type = "number";
      input.min = 0;
      input.max = 10;
      input.step = 0.1;
      input.className = `nota nota-${containerId}-${i}-${j}`;
      input.addEventListener("input", calcularMedias);
      const td = document.createElement("td");
      td.appendChild(input);
      inputRow.appendChild(td);
    });

    container.appendChild(table);
  });
}

function calcularMedias() {
  let somaG = 0, somaE = 0, countG = 0, countE = 0;

  ["fatores-gerais", "fatores-especificos"].forEach((tipo, i) => {
    const fatores = i === 0 ? fatoresGerais : fatoresEspecificos;
    fatores.forEach((fator, fi) => {
      fator.subitens.forEach((_, si) => {
        const val = parseFloat(document.querySelector(`.nota-${tipo}-${fi}-${si}`)?.value || 0);
        if (i === 0) { somaG += val; countG++; }
        else { somaE += val; countE++; }
      });
    });
  });

  const mediaG = (somaG / countG) || 0;
  const mediaE = (somaE / countE) || 0;
  const mediaT = ((mediaG + mediaE) / 2) || 0;

  document.getElementById("mediaGerais").textContent = mediaG.toFixed(1);
  document.getElementById("mediaEspecificos").textContent = mediaE.toFixed(1);
  document.getElementById("mediaTotal").textContent = mediaT.toFixed(1);
}

function gerarPDF() {
  document.querySelector(".btns").style.display = "none";
  html2canvas(document.querySelector("#formulario")).then(canvas => {
    const imgData = canvas.toDataURL("image/png");
    const pdf = new jspdf.jsPDF("p", "pt", "a4");
    const imgProps = pdf.getImageProperties(imgData);
    const pdfWidth = pdf.internal.pageSize.getWidth();
    const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;

    pdf.addImage(imgData, "PNG", 0, 0, pdfWidth, pdfHeight);
    pdf.save("avaliacao.pdf");
    document.querySelector(".btns").style.display = "flex";
  });
}

function exportarXLS() {
  const dados = [];
  const campos = ["nome", "cargo", "admissao", "periodo", "supervisao", "coordenacao"];
  const linha = campos.map(id => document.querySelector(`[name='${id}']`)?.value || "");

  [...fatoresGerais, ...fatoresEspecificos].forEach((fator, i) => {
    fator.subitens.forEach((_, j) => {
      const val = parseFloat(document.querySelector(`.nota-${i < 12 ? 'fatores-gerais' : 'fatores-especificos'}-${i % 12}-${j}`)?.value || 0);
      linha.push(val);
    });
  });

  linha.push(document.querySelector("[name='comentarios']")?.value || "");
  linha.push(document.getElementById("mediaGerais").textContent);
  linha.push(document.getElementById("mediaEspecificos").textContent);
  linha.push(document.getElementById("mediaTotal").textContent);

  dados.push(linha);
  const ws = XLSX.utils.aoa_to_sheet(dados);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Avaliacao");
  XLSX.writeFile(wb, "avaliacao.xlsx");
}

function preencherData() {
  const dataAtual = new Date().toLocaleDateString();
  document.getElementById("dataAtual").textContent = dataAtual;
}

window.onload = () => {
  criarTabelaFatores(fatoresGerais, "fatores-gerais");
  criarTabelaFatores(fatoresEspecificos, "fatores-especificos");
  preencherData();
};
  </script>
</body>
</html>
