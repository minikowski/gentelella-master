<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Avaliação de Desempenho</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; }
    .container { max-width: 1200px; margin: auto; padding: 20px; }
    .header { display: flex; align-items: center; gap: 20px; border-bottom: 2px solid #000; padding-bottom: 10px; margin-bottom: 20px; }
    .header img { height: 80px; }
    .section-title { margin-top: 40px; background: #004080; color: #fff; padding: 10px; }
    .table input[type=number] { width: 70px; }
    .avaliacao-table th, .avaliacao-table td { text-align: center; vertical-align: middle; }
    .assinaturas { margin-top: 60px; }
    .assinatura { display: inline-block; width: 30%; text-align: center; margin-right: 3%; }
    .assinatura hr { margin-top: 40px; margin-bottom: 5px; border: none; border-top: 1px solid #000; }
    .btns { margin-top: 30px; display: flex; gap: 15px; flex-wrap: wrap; }
    textarea { resize: none; }
    table { margin-bottom: 30px; }
  </style>
</head>
<body>
  <div class="container" id="formulario">
    <!-- ... (todo o conteúdo HTML do formulário permanece igual) ... -->
  </div>

  <!-- Scripts do formulário (geração dinâmica das tabelas, cálculo de médias, etc.) -->
  <script>
    document.getElementById('dataAtual').textContent = new Date().toLocaleDateString('pt-BR');

    const fatoresGerais = [
      "Relacionamento Interpessoal", "Disciplina", "Assiduidade", "Pontualidade",
      "Responsabilidade", "Organização", "Comprometimento", "Produtividade",
      "Proatividade", "Ética Profissional", "Iniciativa", "Trabalho em Equipe"
    ];

    const fatoresEspecificos = [
      { nome: "Rotina de sala de atividade", subitens: ["Autogestão", "Acolhida", "Desenv. Ativ.", "Finaliz. Ativ.", "Avaliação", "Intervalo/Almoço", "Trânsito pela Entidade"] },
      { nome: "Escalas de acompanhamento aos educandos", subitens: ["Pontualidade", "Atenção", "Orientação", "Comunicação"] },
      { nome: "Planejamento", subitens: ["Pontualidade", "Preenchimento Adequado", "Solicit. Materiais", "Execução"] },
      { nome: "Percurso", subitens: ["Adequação", "Aplicabilidade", "Cronologia", "Efetividade"] },
      { nome: "Pacto de Convivência e Orientações Comportamentais", subitens: ["Apropriação", "Respeito", "Orientação", "Preenchimento Adequado", "Encaminhamento"] },
      { nome: "Atendimento com educando e família", subitens: ["Postura", "Posição", "Ética", "Integração"] },
      { nome: "Informação e pertencimento SCFV/GML", subitens: ["Alinhamento Valores", "Alinhamento Missão", "Noções Direitos Humanos", "SUAS", "ECA", "Desenv. Pertencimento"] },
      { nome: "Mediação de Conflitos", subitens: ["Prevenção", "Mediação", "Resolução"] }
    ];

    function criarTabelaFatoresGerais() {
      // código existente
    }

    function criarTabelaFatoresEspecificos() {
      // código existente
    }

    function calcularMedias() {
      // código existente
    }

    criarTabelaFatoresGerais();
    criarTabelaFatoresEspecificos();
  </script>

  <!-- Scripts de geração de PDF e XLS -->
  <script>
    async function gerarPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF('p', 'mm', 'a4');
      const nome = document.querySelector("[name='nome']").value;
      const cargo = document.querySelector("[name='cargo']").value;
      const admissao = document.querySelector("[name='admissao']").value;
      const periodo = document.querySelector("[name='periodo']").value;
      const supervisao = document.querySelector("[name='supervisao']").value;
      const coordenacao = document.querySelector("[name='coordenacao']").value;
      const mediaGerais = document.getElementById("mediaGerais").textContent;
      const mediaEspecificos = document.getElementById("mediaEspecificos").textContent;
      const mediaTotal = document.getElementById("mediaTotal").textContent;
      const comentarios = document.querySelector("[name='comentarios']").value;
      const dataAtual = document.getElementById("dataAtual").textContent;

      const img = new Image();
      img.src = 'guarda.jpg';
      await new Promise(resolve => img.onload = resolve);
      doc.addImage(img, 'JPEG', 10, 10, 30, 30);
      doc.setFontSize(16);
      doc.text("Questionário de Avaliação de Desempenho", 45, 20);

      doc.setFontSize(11);
      doc.text(`Nome do Colaborador: ${nome}`, 10, 50);
      doc.text(`Cargo: ${cargo}`, 110, 50);
      doc.text(`Admissão: ${admissao}`, 10, 60);
      doc.text(`Período Avaliado: ${periodo}`, 110, 60);
      doc.text(`Supervisão: ${supervisao}`, 10, 70);
      doc.text(`Coordenação: ${coordenacao}`, 110, 70);
      doc.text(`Gerência Geral: CLÁUDIO MELO`, 10, 80);
      doc.text(`Gestão de Pessoas: JULIANA`, 110, 80);

      let y = 90;
      doc.setFontSize(12);
      doc.text('Notas - Fatores Gerais (1 a 12)', 10, y);
      y += 6;
      fatoresGerais.forEach((nome, i) => {
        const val = document.querySelector(`[name='fator${i + 1}']`).value || '0';
        doc.text(`${i + 1}. ${nome}: ${val}`, 10, y);
        y += 6;
      });

      doc.text('Notas - Fatores Específicos (13 a 20)', 10, y);
      y += 6;
      fatoresEspecificos.forEach((item, idx) => {
        const subnotas = item.subitens.map((_, i) => document.querySelector(`[name='esp${idx}_${i}']`).value || '0');
        const media = document.getElementById(`mediaEsp${idx}`).textContent;
        doc.text(`${idx + 13}. ${item.nome}: ${subnotas.join(', ')} | Média: ${media}`, 10, y);
        y += 6;
      });

      y += 4;
      doc.text(`Média Fatores Gerais: ${mediaGerais}`, 10, y);
      y += 6;
      doc.text(`Média Fatores Específicos: ${mediaEspecificos}`, 10, y);
      y += 6;
      doc.text(`Média Total: ${mediaTotal}`, 10, y);
      y += 10;

      doc.text('Comentários:', 10, y);
      y += 6;
      doc.setFontSize(10);
      const comentarioLinhas = doc.splitTextToSize(comentarios, 180);
      doc.text(comentarioLinhas, 10, y);
      y += comentarioLinhas.length * 5;

      y += 20;
      doc.setFontSize(11);
      doc.text('Assinaturas:', 10, y);
      y += 10;
      const x1 = 10, x2 = 70, x3 = 130;
      doc.line(x1, y, x1 + 50, y);
      doc.line(x2, y, x2 + 50, y);
      doc.line(x3, y, x3 + 50, y);
      doc.text('Gestor Responsável', x1, y + 6);
      doc.text('Coordenação Pedagógica', x2, y + 6);
      doc.text('Gerência Geral', x3, y + 6);
      y += 20;
      doc.line(x1, y, x1 + 50, y);
      doc.text('Departamento Pessoal', x1, y + 6);

      y += 16;
      doc.text(`Data: ${dataAtual}`, 10, y);

      doc.save(`avaliacao_${nome.replace(/\s/g, '_')}.pdf`);
    }

    function exportarXLS() {
      const nome = document.querySelector("[name='nome']").value;
      const cargo = document.querySelector("[name='cargo']").value;
      const linha = [nome, cargo];

      fatoresGerais.forEach((_, i) => {
        const val = document.querySelector(`[name='fator${i + 1}']`).value || '0';
        linha.push(val);
      });
      fatoresEspecificos.forEach((item, idx) => {
        item.subitens.forEach((_, i) => {
          const val = document.querySelector(`[name='esp${idx}_${i}']`).value || '0';
          linha.push(val);
        });
        const media = document.getElementById(`mediaEsp${idx}`).textContent;
        linha.push(media);
      });
      linha.push(document.getElementById('mediaGerais').textContent);
      linha.push(document.getElementById('mediaEspecificos').textContent);
      linha.push(document.getElementById('mediaTotal').textContent);

      const wb = XLSX.utils.book_new();
      const ws = XLSX.utils.aoa_to_sheet([linha]);
      XLSX.utils.book_append_sheet(wb, ws, "Avaliacao");
      XLSX.writeFile(wb, `avaliacao_${nome.replace(/\s/g, '_')}.xlsx`);
    }
  </script>
</body>
</html>