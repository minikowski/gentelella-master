<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Gerador de Recado</title>
  <style>
    body {
      background: white;
      font-family: Georgia, serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 40px;
    }
    form {
      display: flex;
      flex-direction: column;
      gap: 12px;
      width: 300px;
    }
    input, textarea, button {
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 10px;
      font-family: Georgia, serif;
      font-size: 16px;
    }
    button {
      background-color: #333;
      color: white;
      cursor: pointer;
      transition: 0.3s;
    }
    button:hover {
      background-color: #555;
    }
    canvas {
      display: none;
    }
  </style>
</head>
<body>

  <form id="recadoForm">
    <input type="text" id="titulo" maxlength="80" placeholder="TÃ­tulo" required>
    <textarea id="descricao" maxlength="300" rows="4" placeholder="DescriÃ§Ã£o" required></textarea>
    <input type="text" id="dataLocal" maxlength="100" placeholder="Data e Local (ex: 05/05/2025 - SÃ£o Paulo)" required>
    <button type="submit">Gerar JPG</button>
  </form>

  <canvas id="canvas" width="1080" height="1080"></canvas>

  <script>
    const form = document.getElementById('recadoForm');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const titulo = document.getElementById('titulo').value.trim();
      const descricao = document.getElementById('descricao').value.trim();
      const dataLocal = document.getElementById('dataLocal').value.trim();

      const cabecalho = await loadImage('cabecalho.jpg');
      const rodape = await loadImage('rodape.jpg');

      // Fundo branco
      ctx.fillStyle = 'white';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // CabeÃ§alho
      ctx.drawImage(cabecalho, 0, 0, canvas.width, cabecalho.height);

      // TÃ­tulo â€“ 25% maior
      ctx.font = 'bold 50px Georgia';
      ctx.fillStyle = '#000';
      ctx.textAlign = 'center';
      ctx.fillText(titulo, canvas.width / 2, 350);

      // DescriÃ§Ã£o
      ctx.font = '36px Georgia';
      const maxWidth = 1060;
      const descriptionLines = wrapText(ctx, descricao, maxWidth);
      let startY = 400;
      for (let line of descriptionLines) {
        ctx.fillText(line, canvas.width / 2, startY);
        startY += 40;
      }

      // Caixa com Data e Local
      const boxPadding = 20;
      const text = `ðŸ“ ${dataLocal}`;
      ctx.font = 'italic 24px Georgia';
      const textWidth = ctx.measureText(text).width;
      const boxWidth = textWidth + boxPadding * 2;
      const boxHeight = 50;
      const boxX = (canvas.width - boxWidth) / 2;
      const boxY = startY + 20;

      // Caixa arredondada
      ctx.fillStyle = '#f2f2f2';
      ctx.beginPath();
      const radius = 12;
      roundedRect(ctx, boxX, boxY, boxWidth, boxHeight, radius);
      ctx.fill();

      // Texto dentro da caixa
      ctx.fillStyle = '#555';
      ctx.fillText(text, canvas.width / 2, boxY + 32);

      // RodapÃ©
      ctx.drawImage(rodape, 0, canvas.height - rodape.height, canvas.width, rodape.height);

      // Salvar imagem
      const link = document.createElement('a');
      link.download = 'recado.jpg';
      link.href = canvas.toDataURL('image/jpeg');
      link.click();
    });

    function loadImage(src) {
      return new Promise((resolve, reject) => {
        const img = new Image();
        img.src = src;
        img.onload = () => resolve(img);
        img.onerror = reject;
      });
    }

    function wrapText(ctx, text, maxWidth) {
      const words = text.split(' ');
      const lines = [];
      let line = '';
      for (let word of words) {
        const testLine = line + word + ' ';
        const metrics = ctx.measureText(testLine);
        if (metrics.width > maxWidth && line !== '') {
          lines.push(line.trim());
          line = word + ' ';
        } else {
          line = testLine;
        }
      }
      if (line) lines.push(line.trim());
      return lines;
    }

    function roundedRect(ctx, x, y, width, height, radius) {
      ctx.beginPath();
      ctx.moveTo(x + radius, y);
      ctx.lineTo(x + width - radius, y);
      ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
      ctx.lineTo(x + width, y + height - radius);
      ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
      ctx.lineTo(x + radius, y + height);
      ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
      ctx.lineTo(x, y + radius);
      ctx.quadraticCurveTo(x, y, x + radius, y);
      ctx.closePath();
    }
  </script>

</body>
</html>
